<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial</title>
    
    <link rel="stylesheet" href="_static/navy.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="License" href="license.html" />
    <link rel="prev" title="Publications on OpenMEEG" href="publications.html" /> 
  </head>
  <body role="document">
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; min-height:150px">
    <div style='float:left; display:inline-block'>
        <a href="index.html"><img src="_static/logo.png" border="0" alt="openmeeg"/></a>
    </div>
    <div id="title" style="display:inline-block">
        OpenMEEG
         <br/>
        A C++ package for low-frequency bio-electromagnetism <br/>
        solving forward problems in the field of EEG and MEG
    </div>
    <div style="float:right; display:inline-block">
        <a href="http://www.inria.fr"><img src="_static/inria.png" width="200px" border="0" alt="INRIA"/></a>
    </div>
    <div style="float:right; display:inline-block">
        <a href="https://github.com/openmeeg"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github-camo.global.ssl.fastly.net/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" title="Get OpenMEEG as Open Source package from GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>
    </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="license.html" title="License"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="publications.html" title="Publications on OpenMEEG"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Home</a>&nbsp;|&nbsp;</li>
        <li><a href="why_openmeeg.html">Why OpenMEEG?</a>&nbsp;|&nbsp;</li>
        <li><a href="https://github.com/openmeeg/openmeeg/blob/master/README.rst#install-precompiled-binaries">Download</a>&nbsp;|&nbsp;</li>
        <li><a href="#">Tutorial</a>&nbsp;|&nbsp;</li>
        <li><a href="https://github.com/openmeeg/openmeeg/">Source code</a>&nbsp;|&nbsp;</li>
        <li><a href="license.html">License</a>&nbsp;|&nbsp;</li>
        <li><a href="publications.html">Publications</a>&nbsp;|&nbsp;</li>
        <li><a href="contact.html">Contact us</a>&nbsp;|&nbsp;</li>
        <!-- <li><a href="search.html">Search</a></li> -->
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#data-format">Data format</a><ul>
<li><a class="reference internal" href="#vectors-and-matrices">Vectors and matrices</a></li>
<li><a class="reference internal" href="#geometrical-model-mesh-and-conductivity-files">Geometrical model, mesh and conductivity files</a></li>
<li><a class="reference internal" href="#source-descriptions">Source descriptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#openmeeg-from-the-command-line">OpenMEEG from the command line</a><ul>
<li><a class="reference internal" href="#om-assemble">om_assemble</a><ul>
<li><a class="reference internal" href="#general-options-for-om-assemble">General options for <span class="command">om_assemble</span></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#commands">Commands</a><ul>
<li><a class="reference internal" href="#head-matrix-assembly-headmat">Head Matrix assembly <strong>HeadMat</strong></a></li>
<li><a class="reference internal" href="#source-matrix-assembly-source">Source matrix assembly <strong>Source</strong></a></li>
<li><a class="reference internal" href="#headmat-matrix-inversion"><strong>HeadMat</strong> matrix inversion</a></li>
<li><a class="reference internal" href="#linear-transformation-from-x-to-the-sensor-potential">Linear transformation from X to the sensor potential</a><ul>
<li><a class="reference internal" href="#for-eeg">For EEG</a></li>
<li><a class="reference internal" href="#for-meg">For MEG</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gain-matrix-computation">Gain matrix computation</a><ul>
<li><a class="reference internal" href="#id2">For EEG</a></li>
<li><a class="reference internal" href="#id3">For MEG</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data">Data</a><ul>
<li><a class="reference internal" href="#meshes">Meshes</a></li>
<li><a class="reference internal" href="#sources">Sources</a></li>
<li><a class="reference internal" href="#sensors">Sensors</a></li>
<li><a class="reference internal" href="#geometry-description-file">Geometry description file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conductivity-description-file">Conductivity description file</a></li>
<li><a class="reference internal" href="#source-description">Source description</a><ul>
<li><a class="reference internal" href="#source-position-and-orientation">Source position and orientation</a><ul>
<li><a class="reference internal" href="#isolated-dipoles">Isolated dipoles</a></li>
<li><a class="reference internal" href="#distributed-dipoles">Distributed dipoles</a></li>
<li><a class="reference internal" href="#source-activation">Source activation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sensor-definition">Sensor definition</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="publications.html"
                        title="previous chapter">Publications on OpenMEEG</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="license.html"
                        title="next chapter">License</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#data-format" id="id4">Data format</a><ul>
<li><a class="reference internal" href="#vectors-and-matrices" id="id5">Vectors and matrices</a></li>
<li><a class="reference internal" href="#geometrical-model-mesh-and-conductivity-files" id="id6">Geometrical model, mesh and conductivity files</a></li>
<li><a class="reference internal" href="#source-descriptions" id="id7">Source descriptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#openmeeg-from-the-command-line" id="id8">OpenMEEG from the command line</a><ul>
<li><a class="reference internal" href="#om-assemble" id="id9">om_assemble</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples" id="id10">Examples</a></li>
<li><a class="reference internal" href="#commands" id="id11">Commands</a><ul>
<li><a class="reference internal" href="#head-matrix-assembly-headmat" id="id12">Head Matrix assembly <strong>HeadMat</strong></a></li>
<li><a class="reference internal" href="#source-matrix-assembly-source" id="id13">Source matrix assembly <strong>Source</strong></a></li>
<li><a class="reference internal" href="#headmat-matrix-inversion" id="id14"><strong>HeadMat</strong> matrix inversion</a></li>
<li><a class="reference internal" href="#linear-transformation-from-x-to-the-sensor-potential" id="id15">Linear transformation from X to the sensor potential</a></li>
<li><a class="reference internal" href="#gain-matrix-computation" id="id16">Gain matrix computation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data" id="id17">Data</a><ul>
<li><a class="reference internal" href="#meshes" id="id18">Meshes</a></li>
<li><a class="reference internal" href="#sources" id="id19">Sources</a></li>
<li><a class="reference internal" href="#sensors" id="id20">Sensors</a></li>
<li><a class="reference internal" href="#geometry-description-file" id="id21">Geometry description file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conductivity-description-file" id="id22">Conductivity description file</a></li>
<li><a class="reference internal" href="#source-description" id="id23">Source description</a><ul>
<li><a class="reference internal" href="#source-position-and-orientation" id="id24">Source position and orientation</a></li>
<li><a class="reference internal" href="#sensor-definition" id="id25">Sensor definition</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="data-format">
<h2><a class="toc-backref" href="#id4">Data format</a><a class="headerlink" href="#data-format" title="Permalink to this headline">Â¶</a></h2>
<p>OpenMEEG handles several file formats corresponding to different types of objects: vectors, matrices, head geometries, meshes, dipoles, conductivities.</p>
<div class="section" id="vectors-and-matrices">
<h3><a class="toc-backref" href="#id5">Vectors and matrices</a><a class="headerlink" href="#vectors-and-matrices" title="Permalink to this headline">Â¶</a></h3>
<p>By default, matrices and vectors are stored on disk using a MATLAB file format. Symmetric matrices which are not directly representable in the MATLAB format are represented as a MATLAB struct. Other vector/matrices file formats are also supported. Forcing a specific file format is achieved by specifying the proper file extension. Matlab extension is <code class="docutils literal"><span class="pre">.mat</span></code>. Other useful file formats are ASCII (extension <code class="docutils literal"><span class="pre">.txt</span></code>) which generates human readable files, and BrainVisa texture file format (extension <code class="docutils literal"><span class="pre">.tex</span></code>).</p>
<p>OpenMEEG&#8217;s own binary file format (extension <code class="docutils literal"><span class="pre">.bin</span></code>) is available solely for backward compatibility and should be considered as deprecated (as it is subsumed by the MATLAB file format).</p>
</div>
<div class="section" id="geometrical-model-mesh-and-conductivity-files">
<h3><a class="toc-backref" href="#id6">Geometrical model, mesh and conductivity files</a><a class="headerlink" href="#geometrical-model-mesh-and-conductivity-files" title="Permalink to this headline">Â¶</a></h3>
<p><strong>OpenMEEG geometrical models</strong> are described through several files. The toplevel file (generally ending with the extension <code class="docutils literal"><span class="pre">.geom</span></code>) assembles various interface descriptions to build <em>Domains</em> corresponding to head tissues. Empty lines or lines beginning with <code class="docutils literal"><span class="pre">#</span></code> are non-significant.</p>
<p>The file must start with a special comment line which allows its identification (see example in Figure~ref{fig:geom}).
Geometrical models globally contain 2 sections, one for describing the interfaces and one for describing the domains.
In OpenMEEG, we make the following distinction between Mesh and Interface, which is helpful for defining non nested geometries.</p>
<blockquote>
<div><ul class="simple">
<li>&#8220;Mesh&#8221;: a collection of vertices and triangles all connected.</li>
<li>&#8220;Interface&#8221;: a closed mesh.</li>
</ul>
</div></blockquote>
<p>Sample non-nested geometry description:</p>
<a class="reference internal image-reference" href="_images/geom1.png"><img alt="Geometry .geom" class="align-center" src="_images/geom1.png" style="width: 600px;" /></a>
<p>Sample nested geometry descriptions:</p>
<a class="reference internal image-reference" href="_images/geom2.png"><img alt="Geometry .geom" class="align-center" src="_images/geom2.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="_images/geom3.png"><img alt="Geometry .geom" class="align-center" src="_images/geom3.png" style="width: 600px;" /></a>
<p>The section starting with the keyword <code class="docutils literal"><span class="pre">MeshFile`is</span> <span class="pre">optional,</span> <span class="pre">as</span> <span class="pre">well</span> <span class="pre">as</span> <span class="pre">the</span> <span class="pre">section</span> <span class="pre">``Meshes</span></code>.</p>
<p>If <code class="docutils literal"><span class="pre">MeshFile</span></code> is found, it specifies the path to the VTK/vtp file containing the vertices and annoted triangles of your geometry. (Triangle annotations are labels that specify the mesh names).</p>
<p>If <code class="docutils literal"><span class="pre">Meshes</span></code> is found, it specifies the paths to the meshes that may or may not be named. Mesh file formats supported are tri, bnd, mesh, off, and vtk (in case you use VTK).</p>
<p>A Mesh is defined with the keyword <code class="docutils literal"><span class="pre">Mesh</span></code> followed by an optional name and &#8220;<code class="docutils literal"><span class="pre">:</span></code>&#8221;.</p>
<p>If no name is provided, the Mesh is named by its index (starting from 1).</p>
<p>If none of the two sections <code class="docutils literal"><span class="pre">MeshFile</span></code> and <code class="docutils literal"><span class="pre">Meshes</span></code> are present, the next section called <code class="docutils literal"><span class="pre">Interfaces</span></code> is expected to contain the filenames of the meshes.</p>
<p><code class="docutils literal"><span class="pre">Interfaces</span></code> section specifies the mesh descriptions of the interfaces between tissues.
It is introduced by the keyword <code class="docutils literal"><span class="pre">Interfaces</span></code> followed by the number of such interfaces.</p>
<p>An Interface is defined with the keyword <code class="docutils literal"><span class="pre">Interface`followed</span> <span class="pre">by</span> <span class="pre">a</span> <span class="pre">name</span> <span class="pre">and</span> <span class="pre">&quot;</span></code>:<code class="docutils literal"><span class="pre">&quot;.</span>
<span class="pre">If</span> <span class="pre">no</span> <span class="pre">name</span> <span class="pre">is</span> <span class="pre">provided,</span> <span class="pre">the</span> <span class="pre">Interface</span> <span class="pre">is</span> <span class="pre">named</span> <span class="pre">by</span> <span class="pre">its</span> <span class="pre">index</span> <span class="pre">(starting</span> <span class="pre">from</span> <span class="pre">1).</span>
<span class="pre">If</span> <span class="pre">the</span> <span class="pre">sections</span> <span class="pre">``MeshFile</span></code> and <code class="docutils literal"><span class="pre">Meshes</span></code> were NOT specified before, a path to a mesh file is expected.
In the opposite case, a sequence of mesh names is expected.</p>
<p>These meshes are concatenated to form a closed Interface.</p>
<p>&#8216;+&#8217; or &#8216;-&#8216; sign preceeding a mesh name reorients the meshes in order to form a consistently oriented interface.</p>
<p>The second section describes the head tissues and is introduced by the keyword <code class="docutils literal"><span class="pre">Domains</span></code> followed by the number of such domains. Each domain is then described, one domain per line, by the keyword <code class="docutils literal"><span class="pre">Domain</span></code> followed by the domain name (which serves for identification and also appears in the conductivity description) followed by a list of IDs (names or integers).
These IDs are the interface names (as depicted in previous paragraph).
They must be preceeded by a &#8216;+&#8217; or &#8216;-&#8216; sign to indicate whether the domain is outside or inside the corresponding interface (as defined by the outward normal of the interface).
See Figure~ref{fig:geom} for a detailed example.</p>
<p><strong>Mesh files</strong> (generally ending with the <code class="docutils literal"><span class="pre">.tri</span></code> extension) follow the BrainVisa file format for meshes. These files contain two sections. Each section is
introduced by the character <code class="docutils literal"><span class="pre">-</span></code> appearing at the beginning of the line followed by a space followed by either one number (first section) or three times
the same number (second section).</p>
<p><strong>The first section</strong> contains a list of points with associated normals. The number on the line introducing the section is the number of points.
Each following line corresponds to a single point. Its coordinates are the three first numbers appearing on the line. The normal corresponds
to the following three numbers. Each point is assigned an index (starting at 0) corresponding to its order of appearance in the list.</p>
<p><strong>The second section</strong> contains the triangles of the mesh. The number (repeated three times) in the section delimiter corresponds to the number of triangles.
Each triangle is depicted by a sequence of three integers corresponding to the indices of the points assigned as described in the previous paragraph.</p>
<p>The following small example describes a very simple mesh containing 4 points and 4 triangles:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">4</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">0.5773</span> <span class="o">-</span><span class="mf">0.5773</span> <span class="o">-</span><span class="mf">0.5773</span>
<span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">-</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">3</span>
<span class="mi">0</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Interfaces are required to be closed in order for the Boundary Element Method to function correctly. This is also necessary for the source meshes when computing forward solutions using surfacic source models (see below). Moreover, the interface meshes must not intersect each other. Non-intersection can be checked with the command <span class="command">om_check_geom</span>. The command <span class="command">om_mesh_info</span> applied to a mesh provides its number of points, of triangles, minimum and maximum triangle area, and also its Euler characteristic. The Euler characteristic of a closed mesh of genus 0 (homotopic to a sphere) is equal to 2. The Euler characteristic gives an indication if a mesh is likely to be closed or not.</p>
<p>In order to generate a VTK/vtp file, one can use the tool provided <span class="command">om_meshes_to_vtp</span>, which from a list of (closed or not) meshes and names, remove dupplicated vertices and create an easily viewable file in VTK/Paraview.</p>
<p>In order to check a geometry file, one can use the tool provided <span class="command">om_check_geom</span>, which display the read informations.</p>
<p>A <strong>conductivity file</strong> (generally ending with the extension <code class="docutils literal"><span class="pre">.cond</span></code>) is a simple ASCII file that contains associations between tissue names and conductivity values. Associations are provided one per line. Empty lines or lines beginning with <code class="docutils literal"><span class="pre">#</span></code> are non-significant. The file must start with a special comment line which allows its identification. The next figure provides an example conductivity file corresponding to the geometry file presented above.</p>
<a class="reference internal image-reference" href="_images/cond.png"><img alt="Conductivities" class="align-center" src="_images/cond.png" style="width: 600px;" /></a>
<p>Note that the tissue names are the ones appearing in the Domains descriptions of the file depicting the geometrical model.</p>
</div>
<div class="section" id="source-descriptions">
<h3><a class="toc-backref" href="#id7">Source descriptions</a><a class="headerlink" href="#source-descriptions" title="Permalink to this headline">Â¶</a></h3>
<p>Sources may be represented either by a surfacic distribution of dipoles, or by isolated dipoles.</p>
<p>A <strong>surfacic distribution</strong> can be defined by a mesh that supports the dipoles. The dipole orientations are then constrained to the normal direction to the mesh and the moment amplitude is modelled as continuous across the mesh (piecewise linear). Source values are defined at the mesh vertices.</p>
<p><strong>Isolated dipoles</strong> are defined by a simple ASCII file as shown below:</p>
<a class="reference internal image-reference" href="_images/dipolePositions_en.png"><img alt="dipole positions" class="align-center" src="_images/dipolePositions_en.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="openmeeg-from-the-command-line">
<h2><a class="toc-backref" href="#id8">OpenMEEG from the command line</a><a class="headerlink" href="#openmeeg-from-the-command-line" title="Permalink to this headline">Â¶</a></h2>
<p>Diagram for the low level pipeline for computing MEG and EEG leadfields (a.k.a., gain matrices) using OpenMEEG:</p>
<a class="reference internal image-reference" href="_images/OpenMEEGSimple.png"><img alt="dipole positions" class="align-center" src="_images/OpenMEEGSimple.png" style="width: 600px;" /></a>
<p>This section reviews the main OpenMEEG command line tools. The general syntax and
main options of each command is briefly provided.</p>
<p>Full details are available in OpenMEEG documentation. In this section, command names are
in <span class="command">red</span>, options are in <span class="opt">green</span> and produced files are shown in <span class="output">blue</span>.</p>
<div class="section" id="om-assemble">
<h3><a class="toc-backref" href="#id9">om_assemble</a><a class="headerlink" href="#om-assemble" title="Permalink to this headline">Â¶</a></h3>
<p>General syntax:</p>
<p><span class="command">om_assemble :opt:`Option</span> <span class="opt">Parameters</span> <span class="output">Matrix</span></p>
<p>This program assembles the different matrices to be used in
later stages. It uses the head description, the sources and the sensors information.
<span class="opt">Option</span> selects the type of matrice to assemble.
<span class="opt">Parameters</span> depends on the specific option <span class="opt">Option</span>.
Except if otherwise noted, it takes the form:</p>
<p><span class="input">subject.geom</span> <span class="input">subject.cond</span> <span class="opt">OptParam</span>
where subject.geom and subject.cond are files describing respectively the geometrical model and the conductivities of the head (see section ???
for a short description of these files). <span class="opt">OptParam</span> depends on the actual <span class="opt">Option</span>. <span class="output">Matrix</span> is the name of the output file containing the computed matrix.</p>
<p>We now detail the possible <span class="opt">Options</span> (with their abbreviated versions given in parentheses), allowing to define various matrices to assemble:</p>
<div class="section" id="general-options-for-om-assemble">
<h4>General options for <span class="command">om_assemble</span><a class="headerlink" href="#general-options-for-om-assemble" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><ul class="simple">
<li><span class="opt">-help</span> (<span class="opt">-h</span>,:opt:<cite>&#8211;help</cite>): summarizes all possible options.</li>
</ul>
</div></blockquote>
<p>Head modelling options for <span class="command">om_assemble</span>: produce matrices linked to the propagation of electrical signals in the head.</p>
<blockquote>
<div><ul class="simple">
<li><span class="opt">-HeadMat</span> (<span class="opt">-HM</span>, <span class="opt">-hm</span>): <span class="command">om_assemble</span> computes the Head matrix for Symmetric BEM (left-hand side of the linear system). This matrix corresponds to the propagation of electrical signals within the head. There is no <span class="opt">OptParam</span> in this case.</li>
</ul>
</div></blockquote>
<p>Source modelling options for <span class="command">om_assemble</span>: compute the source matrix for Symmetric BEM (right-hand side of the linear system). This matrix maps the representation of the sources to their associated electric potential in an infinite medium (<img class="math" src="_images/math/54ad3cb425784d77aef577831a85601e12601d27.png" alt="v_{\Omega_1}"/>). Different options exist for the 2 types of source models:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><span class="opt">-SurfSourceMat</span> (<span class="opt">-SSM</span>, <span class="opt">-ssm</span>): should be used for continuous surfacic distributions of dipoles.</dt>
<dd><p class="first last"><span class="opt">OptParam</span> is a file containing a mesh that describes the surface.  For faster computations, one can consider giving the name of the domain (containing all dipoles) as a string as an optional parameter in the end of the command line.</p>
</dd>
</dl>
</li>
<li><p class="first"><span class="opt">-DipSourceMat</span> (<span class="opt">-DSM</span>, <span class="opt">-dsm</span>): should be used when considering several isolated dipoles.
This model is the most commonly used and should be used by default even if the dipoles correspond to
the vertices of a cortical mesh. <span class="opt">OptParam</span> is a file containing the dipole descriptions. For faster computations, one can consider giving the name of the domain (containing all dipoles) as a string as an optional parameter in the end of the command line (see Example).</p>
</li>
</ul>
</div></blockquote>
<p>Sensor modelling options for <span class="command">om_assemble</span>: compute matrices that integrate source information and computed potentials to provide the actual solution of the forward problem. The situation is slightly different for EEG, which only needs to compute the electric potential, and for MEG, which depends both on the electric potential and on the sources:</p>
<blockquote>
<div><ul>
<li><p class="first"><span class="opt">-Head2EEGMat</span> (<span class="opt">-H2EM</span>, <span class="opt">-h2em</span>): <span class="command">om_assemble</span> computes the interpolation matrix that maps potentials computed on the scalp to EEG sensors. <span class="opt">OptParam</span> is a file describing the EEG sensor positions.</p>
</li>
<li><p class="first"><span class="opt">-Head2MEGMat</span> (<span class="opt">-H2MM</span>, <span class="opt">-h2mm</span>): <span class="command">om_assemble</span> computes the contribution of Ohmic currents to the MEG sensors. <span class="opt">OptParam</span> is a file describing the SQUIDS geometries and characteristics.</p>
</li>
<li><p class="first"><span class="opt">-Head2InternalPotMat</span> (<span class="opt">-H2IPM</span>, <span class="opt">-h2ipm</span>): <span class="command">om_assemble</span> computes the matrix that allows
the computation of potentials at internal positions from potentials and normal currents on head interfaces, as computed by the symmetric BEM.</p>
</li>
<li><dl class="first docutils">
<dt><span class="opt">-SurfSource2MEGMat</span> (<span class="opt">-SS2MM</span>, <span class="opt">-ss2mm</span>): <span class="command">om_assemble</span> computes the source contribution to the MEG sensors using the same source model as the one used for the option <span class="opt">-SurfSourceMat, i.e. surfacic distribution of dipoles. For this option, :opt:`OptParam</span> takes the form:</dt>
<dd><ul class="first last simple">
<li><span class="input">mesh squids</span> where <span class="input">mesh</span> contains a mesh describing the source surface
and <span class="input">squids</span> is a file  describing the SQUIDS geometries and characteristics.</li>
<li><span class="opt">-DipSource2MEGMat</span> (<span class="opt">-DS2MM</span>, <span class="opt">-ds2mm</span>): <span class="command">om_assemble</span> computes
the source contribution to the  MEG sensors using the same source model as the one used for the option <span class="opt">-DipSourceMat</span>, i.e. isolated dipoles.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>For this option, <span class="opt">OptParam</span> takes the form:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">dipoles squids</span> where <span class="input">dipoles</span> contains the dipole description and <span class="input">squids</span> is a file describing  the SQUIDS geometries and characteristics.</li>
<li><span class="opt">-DipSource2InternalPotMat</span> (<span class="opt">-DS2IPM</span>, <span class="opt">-ds2ipm</span>): <span class="command">om_assemble</span> computes the source  contribution to the chosen internal points. It gives the potential due to isolated dipoles, as if the medium were  infinite. For this option, <span class="opt">OptParam</span> takes the form:</li>
<li><span class="input">dipoles internalPoints</span> where <span class="input">dipoles</span> contains the dipole description and <span class="input">internalPoints</span> is  a file describing the points locations.</li>
</ul>
</div></blockquote>
<p>EIT options for <span class="command">om_assemble</span>:</p>
<blockquote>
<div><ul class="simple">
<li><span class="opt">-EITSourceMat</span> (<span class="opt">-EITSM</span>, <span class="opt">-EITsm</span>,): <span class="command">om_assemble</span> computes the right-hand side for scalp current injection. This usage of <span class="command">om_assemble</span> outputs the right-hand side vector for a given set of EIT electrode. For this option, <span class="opt">OptParam</span> is a file describing the EIT electrode positions.</li>
</ul>
</div></blockquote>
<p><span class="command">om_minverser</span></p>
<p>General syntax:</p>
<p><span class="command">om_minverser</span> HeadMat <span class="output">HeadMatInv</span></p>
<p>This program is used to invert the symmetric matrix as provided by the command <span class="command">om_assemble</span> with the option <span class="opt">-HeadMat</span>.</p>
<dl class="docutils">
<dt>This command has only one option.</dt>
<dd><ul class="first last simple">
<li><span class="opt">-help</span> (<span class="opt">-h</span>,:opt:<cite>&#8211;help</cite>): summarizes the usage of <span class="command">om_minverser</span>.</li>
</ul>
</dd>
</dl>
<p><span class="command">om_gain</span></p>
<p>General syntax:</p>
<p><span class="command">om_gain</span> <span class="opt">Option</span> HeadMatInv <span class="opt">Parameters</span> SourceMat Head2EEGMat <span class="output">GainMatrix</span></p>
<p>This command computes the gain matrix by multiplying together matrices obtained previously (e.g. <span class="input">HeadMatInv</span> is the matrix computed using <span class="command">om_minverser</span>). The resulting gain matrix is stored in the file <span class="output">GainMatrix</span>.
<span class="opt">Option</span> selects the type of matrice to build. <span class="opt">Parameters</span> depend on the specific option <span class="opt">Option</span>.</p>
<p>General options:</p>
<blockquote>
<div><ul class="simple">
<li><span class="opt">-help</span> (<span class="opt">-h</span>,:opt:<cite>&#8211;help</cite>): summarizes the usage of <span class="command">om_gain</span> for all its possible options.</li>
</ul>
</div></blockquote>
<p>Gain matrix type options: select the type of gain matrix to be computed by  <span class="command">om_gain</span>.</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><span class="opt">-EEG</span>: allows to compute an EEG gain matrix. <span class="opt">Parameters</span> are then:\</dt>
<dd><ul class="first last simple">
<li><span class="input">HeadMatInv SourceMat Head2EEGMat</span></li>
<li><span class="input">SourceMat</span> is the matrix obtained using <span class="command">om_assemble</span> with either of the options
<span class="opt">-SurfSourceMat</span> or <span class="opt">-DipSourceMat</span>, depending on the source model. <span class="input">Head2EEGMat</span>
is the matrix obtained using <span class="command">om_assemble</span> with the option <span class="opt">-Head2EEGMat</span>.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><span class="opt">-EEG</span> option is also used to compute an EIT gain matrix: in this case, <span class="input">SourceMat</span></dt>
<dd><p class="first last">should contain the output of the <span class="opt">-EITsource</span> option of <span class="command">om_assemble</span>. Multiplying
the EIT gain matrix by the vector of applied currents at each EIT electrode yields the simulated
potential on the EEG electrodes. The applied current on the EIT electrodes should sum to zero.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><span class="opt">-MEG</span>: allows to compute an MEG gain matrix. <span class="opt">Parameters</span> are then:</dt>
<dd><ul class="first last simple">
<li><span class="input">HeadMatInv SourceMat Head2MEGMat Source2MEGMat</span></li>
<li><span class="input">SourceMat</span> is the matrix obtained using <span class="command">om_assemble</span> with either of the options
<span class="opt">-SurfSourceMat</span> or <span class="opt">-DipSourceMat</span>, depending on the source model. <span class="input">Head2MEGMat</span>
is the matrix obtained using <span class="command">om_assemble</span> with the option <span class="opt">-HeadMEEGMat</span>.
<span class="input">Source2MEGMat</span> is the matrix obtained using <span class="command">om_assemble</span> with either of the
options <span class="opt">-SurfSource2MEGMat</span> or <span class="opt">-DipSource2MEGMat</span>, depending on the source model.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><span class="opt">-InternalPotential</span>: allows to compute an internal potential gain matrix for sensors within
the volume.&nbsp;<span class="opt">Parameters</span> are then:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">HeadMatInv SourceMat Head2InternalPotMat Source2InternalPotMat</span></li>
<li><span class="input">Head2InternalPotMat</span> and <span class="input">Source2InternalPotMat</span> are respectivelly obtained
using <span class="command">om_assemble</span> with option <span class="opt">-Head2InternalPotMat</span> and <span class="opt">-DipSource2InternalPotMat</span>.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id10">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">Â¶</a></h2>
<p>Assuming a head model represented by the geometry file <span class="input">head.geom</span> and the conductivity file <span class="input">head.cond</span> and EEG sensors detailed in a file <span class="input">head.eegsensors</span>.</p>
<p>Computing the EEG gain matrix for sources distributed on the surface represented
by the file <span class="input">sources.tri</span> is done via the following set of commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">om_assemble</span> <span class="o">-</span><span class="n">HeadMat</span> <span class="n">head</span><span class="o">.</span><span class="n">geom</span> <span class="n">head</span><span class="o">.</span><span class="n">cond</span> <span class="n">head</span><span class="o">.</span><span class="n">hm</span>
<span class="n">om_assemble</span> <span class="o">-</span><span class="n">SSM</span> <span class="n">head</span><span class="o">.</span><span class="n">geom</span> <span class="n">head</span><span class="o">.</span><span class="n">cond</span> <span class="n">sources</span><span class="o">.</span><span class="n">tri</span> <span class="n">head</span><span class="o">.</span><span class="n">ssm</span>
<span class="n">om_assemble</span> <span class="o">-</span><span class="n">h2em</span> <span class="n">head</span><span class="o">.</span><span class="n">geom</span> <span class="n">head</span><span class="o">.</span><span class="n">cond</span> <span class="n">head</span><span class="o">.</span><span class="n">eegsensors</span> <span class="n">head</span><span class="o">.</span><span class="n">h2em</span>
<span class="n">om_minverse</span> <span class="n">head</span><span class="o">.</span><span class="n">hm</span> <span class="n">head</span><span class="o">.</span><span class="n">hm_inv</span>
<span class="n">om_gain</span> <span class="o">-</span><span class="n">EEG</span> <span class="n">head</span><span class="o">.</span><span class="n">hm_inv</span> <span class="n">head</span><span class="o">.</span><span class="n">ssm</span> <span class="n">head</span><span class="o">.</span><span class="n">h2em</span> <span class="n">head</span><span class="o">.</span><span class="n">gain</span>
</pre></div>
</div>
<p>Considering now isolated dipolar sources detailed in the file <span class="input">sources.dip</span> with MEG sensors depicted in the file <span class="input">head.squids</span>. Using the same head model, the MEG gain matrix is obtained via the following set of commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">om_assemble</span> <span class="o">-</span><span class="n">HeadMat</span> <span class="n">head</span><span class="o">.</span><span class="n">geom</span> <span class="n">head</span><span class="o">.</span><span class="n">cond</span> <span class="n">head</span><span class="o">.</span><span class="n">hm</span>
<span class="n">om_assemble</span> <span class="o">-</span><span class="n">DSM</span> <span class="n">head</span><span class="o">.</span><span class="n">geom</span> <span class="n">head</span><span class="o">.</span><span class="n">cond</span> <span class="n">sources</span><span class="o">.</span><span class="n">dip</span> <span class="n">head</span><span class="o">.</span><span class="n">dsm</span>
<span class="n">om_assemble</span> <span class="o">-</span><span class="n">h2mm</span> <span class="n">head</span><span class="o">.</span><span class="n">geom</span> <span class="n">head</span><span class="o">.</span><span class="n">cond</span> <span class="n">head</span><span class="o">.</span><span class="n">squids</span> <span class="n">head</span><span class="o">.</span><span class="n">h2mm</span>
<span class="n">om_assemble</span> <span class="o">-</span><span class="n">ds2mm</span> <span class="n">sources</span><span class="o">.</span><span class="n">dip</span> <span class="n">head</span><span class="o">.</span><span class="n">squids</span> <span class="n">head</span><span class="o">.</span><span class="n">ds2mm</span>
<span class="n">om_minverser</span> <span class="n">head</span><span class="o">.</span><span class="n">hm</span> <span class="n">head</span><span class="o">.</span><span class="n">hm_inv</span>
<span class="n">om_gain</span> <span class="o">-</span><span class="n">MEG</span> <span class="n">head</span><span class="o">.</span><span class="n">hm_inv</span> <span class="n">head</span><span class="o">.</span><span class="n">dsm</span> <span class="n">head</span><span class="o">.</span><span class="n">h2mm</span> <span class="n">head</span><span class="o">.</span><span class="n">ds2mm</span> <span class="n">head</span><span class="o">.</span><span class="n">gain</span>
</pre></div>
</div>
</div>
<div class="section" id="commands">
<h2><a class="toc-backref" href="#id11">Commands</a><a class="headerlink" href="#commands" title="Permalink to this headline">Â¶</a></h2>
<p>In the following, the binaries in <span class="command">red</span>, the options in <span class="opt">green</span>, the inputs are in <span class="input">black</span> and the outputs in <span class="output">blue</span>.</p>
<div class="section" id="head-matrix-assembly-headmat">
<h3><a class="toc-backref" href="#id12">Head Matrix assembly <strong>HeadMat</strong></a><a class="headerlink" href="#head-matrix-assembly-headmat" title="Permalink to this headline">Â¶</a></h3>
<p>Input:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">subject.geom</span>: geometry description file (see Appendix~ref{sec:geom})</li>
<li><span class="input">subject.cond</span>: conductivity description file (see Appendix~ref{sec:cond})</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">HeadMat.bin</span>: binary file containing the matrix <strong>HeadMat</strong> (symmetric format).</li>
</ul>
</div></blockquote>
<p>The symmetric format only stores the lower half of a matrix.</p>
<p><span class="command">om_assemble</span> <span class="opt">-HeadMat</span> subject.geom subject.cond <span class="output">HeadMat.bin</span></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the abbreviated option names <span class="opt">-HM</span> or <span class="opt">-hm</span> can be used instead of <span class="opt">-HeadMat</span>.</p>
</div>
</div>
<div class="section" id="source-matrix-assembly-source">
<h3><a class="toc-backref" href="#id13">Source matrix assembly <strong>Source</strong></a><a class="headerlink" href="#source-matrix-assembly-source" title="Permalink to this headline">Â¶</a></h3>
<p>Input:</p>
<blockquote>
<div><ul>
<li><p class="first"><span class="input">subject.geom</span>: geometry description file (see Appendix~ref{sec:geom})</p>
</li>
<li><p class="first"><span class="input">subject.cond</span>: conductivity description file (see Appendix~ref{sec:cond})</p>
</li>
<li><dl class="first docutils">
<dt>the source(s):</dt>
<dd><ul class="first last simple">
<li>dipolar case: <span class="input">dipolePosition.dip</span> dipole description file (list of coordinates and orientations) (see Appendix~ref{sec:dipoles})</li>
<li>case of distributed sources: <span class="input">sourcemesh</span>: source mesh (accepted formats:  *.tri or *.mesh of
BrainVisa, or *.vtk)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">SourceMat.bin</span>: binary file containing <strong>SourceMat</strong></li>
</ul>
</div></blockquote>
<p>For dipolar sources:</p>
<blockquote>
<div><ul class="simple">
<li><span class="command">om_assemble</span> <span class="opt">-DipSourceMat</span> subject.geom subject.cond dipolePosition.dip <span class="output">SourceMat.bin</span></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the abbreviated option names <span class="opt">-DSM</span> or <span class="opt">-dsm</span> can be used instead of <span class="opt">-DipSourceMat</span>.</p>
</div>
<p>For distributed sources:</p>
<blockquote>
<div><ul class="simple">
<li><span class="command">om_assemble</span> <span class="opt">-SurfSourceMat</span> subject.geom subject.cond sourcemesh <span class="output">SourceMat.bin</span></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the abbreviated option names  <span class="opt">-SSM</span> or <span class="opt">-ssm</span>  can be used instead of  <span class="opt">-SurfSourceMat</span>.</p>
</div>
</div>
<div class="section" id="headmat-matrix-inversion">
<h3><a class="toc-backref" href="#id14"><strong>HeadMat</strong> matrix inversion</a><a class="headerlink" href="#headmat-matrix-inversion" title="Permalink to this headline">Â¶</a></h3>
<p>Input:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">HeadMat.bin</span> binary file containing matrix <strong>HeadMat</strong> (symmetric format)</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">HeadMatInv.bin</span>: binary file containing matrix <strong>inverse(HeadMat)</strong> (symmetric format)</li>
</ul>
</div></blockquote>
<p><span class="command">om_minverser</span> HeadMat.bin <span class="output">HeadMatInv.bin</span></p>
</div>
<div class="section" id="linear-transformation-from-x-to-the-sensor-potential">
<h3><a class="toc-backref" href="#id15">Linear transformation from X to the sensor potential</a><a class="headerlink" href="#linear-transformation-from-x-to-the-sensor-potential" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="for-eeg">
<h4>For EEG<a class="headerlink" href="#for-eeg" title="Permalink to this headline">Â¶</a></h4>
<p>A linear interpolation is computed which relates X to the electrode potential through the linear transformation:</p>
<div class="math">
<p><img src="_images/math/08258ee056a95783cdb881462482979f789eb4c3.png" alt="\mathbf{V_{electrode}} = \mathbf{Head2EEG} . \mathbf{X}"/></p>
</div><p>where:</p>
<blockquote>
<div><ul class="simple">
<li><strong>V_{electrode}</strong> is the column-vector of potential values at the sensors (output of EEG forward problem),</li>
<li><strong>X</strong> is the column-vector containing the values of the potential and the normal current on all the surface of the model,</li>
<li><strong>Head2EEGMat</strong> is the linear transformation to be computed.</li>
</ul>
</div></blockquote>
<p>Input:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">subject.geom</span> geometry description file (see Appendix~ref{sec:geom})</li>
<li><span class="input">subject.cond</span> conductivity description file (see Appendix~ref{sec:cond})</li>
<li><span class="input">patchespositions.txt</span> file containing the positions of the EEG electrodes (see Appendix~ref{sec:sensors})</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">Head2EEGMat.bin</span>: file containing the matrix <strong>Head2EEGMat</strong> (sparse format)</li>
</ul>
</div></blockquote>
<p>The sparse format allows to store efficiently matrices containing a small proportion of non-zero values.</p>
<p><span class="command">om_assemble</span> <span class="opt">-Head2EEGMat</span> subject.geom subject.cond patchespositions.txt <span class="output">Head2EEGMat.bin</span></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the abbreviated option names <span class="opt">-H2EM`or :opt:</span>-h2em`can be used instead of <span class="opt">-Head2EEGMat</span>.</p>
</div>
</div>
<div class="section" id="for-meg">
<h4>For MEG<a class="headerlink" href="#for-meg" title="Permalink to this headline">Â¶</a></h4>
<p>In the case of MEG there are more matrices to assemble, as explained in section~ref{}.
The magnetic field is related both to the sources directly, as well as to the electric  potential, according to:</p>
<div class="math">
<p><img src="_images/math/0890f315cb35fc7edc3228e8bb09c55b276dec54.png" alt="\mathbf{M_{sensor}} = \mathbf{Source2MEGMat} . \mathbf{S} + \mathbf{Head2MEGMat}.\mathbf{X}"/></p>
</div><p>Contribution to MEG from the potential (<strong>Head2MEGMat</strong>):</p>
<p>Input:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">subject.geom</span> geometry description file (see Appendix~ref{sec:geom})</li>
<li><span class="input">subject.cond</span> conductivity description file (see Appendix~ref{sec:cond})</li>
<li><span class="input">sensorpositions.txt</span> positions and orientations of MEG sensors (see Appendix~ref{sec:sensors})</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">Head2MegMat.bin</span> binary file containing <strong>Head2MEGMat</strong></li>
</ul>
</div></blockquote>
<p><span class="command">om_assemble</span> <span class="opt">-Head2MEGMat</span> subject.geom subject.cond sensorpositions.txt <span class="output">Head2MEGMat.bin</span></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the abbreviated option names <span class="opt">-H2MM</span> or <span class="opt">-h2mm</span> can be used instead of <span class="opt">-Head2MEGMat</span>.</p>
</div>
<p>Contribution to MEG from the sources (<strong>Source2MEGMat</strong>):</p>
<p>Input:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>the source(s):</dt>
<dd><ul class="first last simple">
<li>[[dipolar sources]] <span class="input">dipolePosition.dip</span>  dipole description file (list of coordinates and orientations) (see Appendix~ref{sec:dipoles})</li>
<li>[[distributed sources]] <span class="input">sourcemesh</span>  source mesh (accepted formats:  *.tri or *.mesh of BrainVisa, or *.vtk)</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><span class="input">sensorpositions.txt</span> positions and orientations of MEG sensors (see Appendix~ref{sec:sensors})</p>
</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">DipSource2MEGMat.bin</span> binary file containing <strong>DipSource2MEGMat</strong> \</li>
<li>or <span class="output">SurfSource2MEGMat.bin</span> binary file containing <strong>SurfSource2MEGMat</strong></li>
</ul>
</div></blockquote>
<p>For dipolar sources:</p>
<p><span class="command">om_assemble</span> <span class="opt">-DipSource2MEGMat</span> dipolePosition.dip sensorpositions.txt <span class="output">DipSource2MEGMat.bin</span></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the abbreviated option names <span class="opt">-DS2MM</span> or <span class="opt">-ds2mm</span> can be used instead of <span class="opt">-DipSource2MEGMat</span>.</p>
</div>
<p>For distributed sources:</p>
<p><span class="command">om_assemble</span> <span class="opt">-SurfSource2MEGMat</span> sourcemesh sensorpositions.txt <span class="output">SurfSource2MEGMat.bin</span></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the abbreviated option names  <span class="opt">-SS2MM</span> or <span class="opt">-ss2mm</span> can be used instead of <span class="opt">-SurfSource2MEGMat</span>.</p>
</div>
</div>
</div>
<div class="section" id="gain-matrix-computation">
<h3><a class="toc-backref" href="#id16">Gain matrix computation</a><a class="headerlink" href="#gain-matrix-computation" title="Permalink to this headline">Â¶</a></h3>
<p>The gain matrix represents the linear transformation relating the activation of sources, at <strong>predefined positions and orientations</strong> to the values of the fields of interest (electric potential or magnetic field) at predefined sensor positions (and orientations for MEG).</p>
<div class="section" id="id2">
<h4>For EEG<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h4>
<p>Input:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">HeadMatInv.bin</span> binary file containing <strong>inv(HeadMat)</strong> (symmetric format)</li>
<li><span class="input">SourceMat.bin</span> binary file containing either  <strong>SurfSourceMat</strong> or  <strong>DipSourceMat</strong></li>
<li><span class="input">Head2EEGMat.bin</span> binary file containing <strong>Head2EEGMat</strong> (sparse format)</li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">GainEEGMat.bin</span> binary file contining the gain matrix</li>
</ul>
</div></blockquote>
<p><span class="command">om_gain</span><span class="opt">-EEG`HeadMatInv.bin SourceMat.bin Head2EEGMat.bin :output:`GainEEGMat.bin</span></p>
</div>
<div class="section" id="id3">
<h4>For MEG<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h4>
<p>Input:</p>
<blockquote>
<div><ul class="simple">
<li><span class="input">HeadMatInv.bin</span> binary file containing <strong>inv(HeadMat)</strong> (symmetric format)</li>
<li><span class="input">SourceMat.bin</span> binary file containing either  <strong>SurfSourceMat</strong> or  <strong>DipSourceMat</strong></li>
<li><span class="input">Head2MEGMat.bin</span> binary file containing <strong>Head2MEGMat</strong></li>
<li><span class="input">Source2MEGMat.bin</span> binary file containing either  <strong>DipSource2MEGMat</strong> or <strong>SurfSource2MEGMat</strong></li>
</ul>
</div></blockquote>
<p>Output:</p>
<blockquote>
<div><ul class="simple">
<li><span class="output">GainMEGMat.bin</span> binary file containing the gain matrix</li>
</ul>
</div></blockquote>
<p><span class="command">om_gain</span><span class="opt">-MEG`HeadMatInv.bin SourceMat.bin Head2MEGMat.bin Source2MEGMat.bin :output:`GainMEGMat.bin</span></p>
</div>
</div>
</div>
<div class="section" id="data">
<h2><a class="toc-backref" href="#id17">Data</a><a class="headerlink" href="#data" title="Permalink to this headline">Â¶</a></h2>
<p>This section describes the type of data that is required to run a forward problem with OpenMEEG.</p>
<div class="section" id="meshes">
<h3><a class="toc-backref" href="#id18">Meshes</a><a class="headerlink" href="#meshes" title="Permalink to this headline">Â¶</a></h3>
<p>Meshes describing the interfaces between regions of homogeneous conductivity. These meshes generally represent:</p>
<blockquote>
<div><ul class="simple">
<li>the inner skull surface</li>
<li>the outer skull surface</li>
<li>the outer scalp surface</li>
</ul>
</div></blockquote>
<p>The recommended mesh size is approximately 600 to 800 points per surface.</p>
<a class="reference internal image-reference" href="_images/tete_couches_brain.png"><img alt="External surface of the cortex" class="align-center" src="_images/tete_couches_brain.png" style="width: 300px;" /></a>
<p>Example with three surfaces: outer scalp (gray), outer skull (blue) and inner skull (pink):</p>
<a class="reference internal image-reference" href="_images/tete_couches_brainskullhead.png"><img alt="Example with three surfaces: outer scalp (gray)," class="align-center" src="_images/tete_couches_brainskullhead.png" style="width: 300px;" /></a>
</div>
<div class="section" id="sources">
<h3><a class="toc-backref" href="#id19">Sources</a><a class="headerlink" href="#sources" title="Permalink to this headline">Â¶</a></h3>
<p>Sources can be of two types: isolated or distributed.</p>
<p>For distributed sources, a source mesh describes their support. This is a detailed
mesh generally covering the whole cortex. The mesh size should not exceed 35 000 points.
The source amplitude is represented as continuous, and linear on each of the mesh triangles.
The source orientation is modeled as piecewise constant, normal to each of the mesh triangles.</p>
<a class="reference internal image-reference" href="_images/cortex.png"><img alt="Cortex" class="align-center" src="_images/cortex.png" style="width: 300px;" /></a>
<p>Isolated sources are the superposition of current dipoles, each of which is defined by its position and its moment.</p>
</div>
<div class="section" id="sensors">
<h3><a class="toc-backref" href="#id20">Sensors</a><a class="headerlink" href="#sensors" title="Permalink to this headline">Â¶</a></h3>
<p>For EEG, the sensors are defined by the list of the x-y-z coordinates of the electrode
positions. The electrodes are considered punctual and are called <em>patches</em>.
The MEG sensor description is more complex, see Appendix~ref{chap:format}.</p>
</div>
<div class="section" id="geometry-description-file">
<h3><a class="toc-backref" href="#id21">Geometry description file</a><a class="headerlink" href="#geometry-description-file" title="Permalink to this headline">Â¶</a></h3>
<dl class="docutils">
<dt>The geometry description file provides:</dt>
<dd><ul class="first last simple">
<li>the number of the meshed surfaces separating the different domains,</li>
<li>the names of the files corresponding to these surfaces,</li>
<li>the number of domains of homogeneous conductivity,</li>
<li>the positions of the domains with respect to the surfaces (inside or outside)</li>
</ul>
</dd>
</dl>
<p>The geometry description file should have as extension: *.geom</p>
<a class="reference internal image-reference" href="_images/geom.png"><img alt="Geometry" class="align-center" src="_images/geom.png" style="width: 600px;" /></a>
<p>The domains are to be described in the following way (first the external surface and then the internal surface):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Domain</span> <span class="n">Brain</span> <span class="o">-</span><span class="mi">1</span>              <span class="o">&amp;</span> \\
<span class="n">Domain</span> <span class="n">Skull</span> \<span class="n">textbf</span><span class="p">{</span><span class="mi">1</span> <span class="o">-</span><span class="mi">2</span><span class="p">}</span>   <span class="o">&amp;</span>  \<span class="n">emph</span><span class="p">{</span><span class="ow">and</span> <span class="ow">not</span> <span class="n">Domain</span> <span class="n">Skull</span> <span class="o">-</span><span class="mi">2</span> <span class="mi">1</span><span class="p">}</span> \\
<span class="n">Domain</span> <span class="n">Skin</span> \<span class="n">textbf</span><span class="p">{</span><span class="mi">2</span> <span class="o">-</span><span class="mi">3</span><span class="p">}</span>  <span class="o">&amp;</span>  \<span class="n">emph</span><span class="p">{</span><span class="ow">and</span> <span class="ow">not</span> <span class="n">Domain</span> <span class="n">Skin</span> <span class="o">-</span><span class="mi">3</span> <span class="mi">2</span><span class="p">}</span>  \\
<span class="n">Domain</span> <span class="n">Air</span> <span class="mi">3</span>                 <span class="o">&amp;</span>  \\
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Meshes paths can be global (as on drawing) or relative to where the command line is executed.
For the meshes, the following formats are allowed:</p>
<blockquote class="last">
<div><ul class="simple">
<li>*.tri~: TRI format corresponding to early BrainVisa. Also handled by Anatomist.</li>
<li>*.mesh~: MESH format corresponding to BrainVisa versions 3.0.2 and later. Also handled by Anatomist.</li>
<li>*.vtk~: VTK mesh format.</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="conductivity-description-file">
<h2><a class="toc-backref" href="#id22">Conductivity description file</a><a class="headerlink" href="#conductivity-description-file" title="Permalink to this headline">Â¶</a></h2>
<p>The conductivity description file defines the conductivity values corresponding to each domain listed in the Geometry Description File (section~ref{sec:geom}).</p>
<p>The file extension should be: *.cond .</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">the domain names should match the ones defined in the Geometry Description File (beware of differences in upper/lower case).</p>
</div>
<a class="reference internal image-reference" href="_images/cond.png"><img alt="Conductivity" class="align-center" src="_images/cond.png" style="width: 600px;" /></a>
</div>
<div class="section" id="source-description">
<h2><a class="toc-backref" href="#id23">Source description</a><a class="headerlink" href="#source-description" title="Permalink to this headline">Â¶</a></h2>
<p>Sources are defined by their geometry (position and orientation)  and their magnitude.
OpenMEEG handles two types of source models: isolated dipoles, or distributed dipoles: these two models differ in their geometry description.</p>
<div class="section" id="source-position-and-orientation">
<h3><a class="toc-backref" href="#id24">Source position and orientation</a><a class="headerlink" href="#source-position-and-orientation" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="isolated-dipoles">
<h4>Isolated dipoles<a class="headerlink" href="#isolated-dipoles" title="Permalink to this headline">Â¶</a></h4>
<p>Isolated dipoles are represented by a text file (extension *.dip or *.txt), in which each line defines a dipole position and orientation, encoded in 6 real values:</p>
<blockquote>
<div><ul class="simple">
<li>three values encoding the Cartesian coordinate for the position,</li>
<li>three values encoding the orientation of the dipole (supposed unitary).</li>
</ul>
</div></blockquote>
<p>The following example shows a file describing 5 isolated dipoles:</p>
<a class="reference internal image-reference" href="_images/dipolePositions_en.png"><img alt="Dipole positions" class="align-center" src="_images/dipolePositions_en.png" style="width: 600px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The referential of the coordinates should be the same as for the meshes (the MR coordinates in general).</p>
</div>
</div>
<div class="section" id="distributed-dipoles">
<h4>Distributed dipoles<a class="headerlink" href="#distributed-dipoles" title="Permalink to this headline">Â¶</a></h4>
<p>Distributed dipoles are supported on a mesh, whose format must be *.mesh, or *.tri, or *.vtk.</p>
</div>
<div class="section" id="source-activation">
<h4>Source activation<a class="headerlink" href="#source-activation" title="Permalink to this headline">Â¶</a></h4>
<p>Source activation files are text files, in which each line corresponds to a source, and each column to a time sample.</p>
<blockquote>
<div><ul class="simple">
<li>for isolated dipoles, the nth line corresponds to the amplitude of the nth dipole (with its fixed orientation)</li>
<li>for distributed dipoles, the nth line correspond to the amplitude of the nth vertex in the source mesh.</li>
</ul>
</div></blockquote>
<p>Example for isolated dipoles:</p>
<a class="reference internal image-reference" href="_images/dipActiv.png"><img alt="Dipole positions" class="align-center" src="_images/dipActiv.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="sensor-definition">
<h3><a class="toc-backref" href="#id25">Sensor definition</a><a class="headerlink" href="#sensor-definition" title="Permalink to this headline">Â¶</a></h3>
<p>The sensor definition is provided in a text file, in which each line provides the position of the sensor, and additional information such as its orientation or its name.
More precisely, there are 5 options for defining sensors:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>1 line per sensor and 3 columns (typically for EEG sensors or MEG sensors without orientation) :</dt>
<dd><ul class="first last simple">
<li>the 1st, 2nd and 3rd columns are respectively position coordinates x, y, z of sensor</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>1 line per sensor and 4 columns (typically for EEG sensors or MEG sensors without orientation) :</dt>
<dd><ul class="first last simple">
<li>the 1st column is sensors names</li>
<li>the 2nd, 3rd and 4th are respectively position coordinates x, y, z of sensor</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>1 line per sensor and 6 columns (typically for MEG sensors) :</dt>
<dd><ul class="first last simple">
<li>the 1st, 2nd and 3rd are respectively position coordinates x, y, z of sensor</li>
<li>the 4th, 5th and 6th are coordinates of vector orientation</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>1 line per sensor and 7 columns (typically for MEG sensors) :</dt>
<dd><ul class="first last simple">
<li>the 1st column is sensors names</li>
<li>the 2nd, 3rd and 4th are respectively position coordinates x, y, z of sensor</li>
<li>the 5th, 6th and 7th are coordinates of vector orientation</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>1 line per integration point for each sensor and 8 columns (typically for MEG realistic sensors with coils, or gradiometers) :</dt>
<dd><ul class="first last simple">
<li>the 1st column is sensors names</li>
<li>the 2nd, 3rd and 4th are respectively position coordinates x, y, z of sensor</li>
<li>the 5th, 6th and 7th are coordinates of vector orientation</li>
<li>the 8th is the weight to apply for numerical integration (related to sensor name)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>An example of MEG sensor description:</p>
<a class="reference internal image-reference" href="_images/sensors-grad.png"><img alt="Sensor description" class="align-center" src="_images/sensors-grad.png" style="width: 600px;" /></a>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2017, OpenMEEG Developers..
      Last updated on Jun 22, 2017.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>